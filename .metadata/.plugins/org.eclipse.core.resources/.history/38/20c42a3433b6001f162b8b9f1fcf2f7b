/*
 * automate.c
 *
 *  Created on: Nov 14, 2024
 *      Author: davidprosperin
 */
#include <automate.h>

void automate_decode(void)
{
    static state_automate_t next_state = FLAG_START1;
    static state_automate_t current_state;

    current_state = next_state;

    switch (current_state)
    {
    case FLAG_START1 :
    	printf("Etat courant : FLAG_START1\n");
    	if (buffer[index_read] == 0xA5)
        {
             next_state = FLAG_START2;
        }
    break;

    case FLAG_START2:
    	printf("Etat courant : FLAG_START2\n");
        if (buffer[index_read] == 0x5A)
        {
            next_state = DATA_AND_SEND_MODE;
        } else {
        	next_state = FLAG_START1;
        }
    break;
    }
    case RESPONSE_DESCRIPTOR:
    	if (buffer[i] == 0xA5 &&
    	    buffer[++i] == 0x5A &&
    	    buffer[++i] == 0x05 &&
    		buffer[++i] == 0x00 &&
    		buffer[++i] == 0x00 &&
    	    buffer[++i] == 0x40 &&
    	    buffer[++i] == 0x81)
    		{
    			  printf("\n------- Primere trame ------\n");
    			  printf("Valeur trame : 0x%x\n", buffer[++i]);
    			  printf("Valeur trame : 0x%x\n", buffer[++i]);
    			  printf("Valeur trame : 0x%x\n", buffer[++i]);
    			  printf("Valeur trame : 0x%x\n", buffer[++i]);
    			  printf("Valeur trame : 0x%x\n", buffer[++i]);
    			  printf("------- Fin primere trame ------\n");
    		}
    	break;

    /*
    case DATA_TYPE:
        if (read_byte_from_buffer() == (CPT=CPT+1))
        {
            next_state = QUALITY;
        }

    break;


    case QUALITY:
            if (read_byte_from_buffer() == (CPT=CPT+1) AND !S=S)
            {
                next_state = ANGLE_FIRST_PART;
            }
    break;

    case ANGLE_FIRST_PART:
        if (read_byte_from_buffer() == c=1
        {
            next_state = ANGLE_SECOND_PART;
    }
    break ;

    if (read_byte_from_buffer() == !c=0
        {
            next_state = QUALITY;
    }
    break ;

        }

    break;

    case ANGLE_SECOND_PART:
            if (read_byte_from_buffer() == (CPT=CPT+1))
            {
                next_state = DISTANCE_FIRST_PART;
            }
    break;

    case DISTANCE_FIRST_PART:
        if (read_byte_from_buffer() == (CPT=CPT+1))
        {
            next_state = DISTANCE_SECOND_PART;
        }

    break;

    case DISTANCE_SECOND_PART:
        {
            next_state = QUALITY;
        }

    break;*/
}
